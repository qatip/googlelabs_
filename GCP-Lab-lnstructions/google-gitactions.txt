Gitactions Student run-book

Create a new private repo on GitHub and a Personal Access token

Copy the token and keep it safe 
  
In the IDE, navigate to googlelab_\githubactions

At the terminal:
	
	cd~/googlelabs_/githubactions

Edit bootstrap/terraform.tfvars:

	project_id = "<your_project_id>"
	repo_full_name = "<your git user or org>/<your repo name>"
	state_bucket_name = "tf-state-<yourname>-###" (globally unique)


Run bootstrap locally:

	cd bootstrap
	terraform init
	terraform apply


Copy the three outputs for later use....

	service_account_email
	state_bucket
	workload_identity_provider_resource

Move up to the parent directory (googlelabs_/githubactions)
	
	cd ..

Clone the repo into your current directory

	git clone {your repo url}

Move into the repo root

	cd {repo name}  

Move the .gitub and infra folders into repo root from parent directory . Leave the bootstrap folder where it is. 

Edit the two workflow YAMLs in the .github folder:
 
Replace WORKLOAD_IDENTITY_PROVIDER with the bootstrap output string.
Replace SERVICE_ACCOUNT with the Service Account email output.
Set GOOGLE_PROJECT (project id).
(Update Region is not using europe-west1 as per bootstrap)

Run..
	
	git add .github/workflows
	git commit -m "Add TF plan/apply workflows"
	git push

Refresh your Repo and verify .github/workflows appear

In the IDE, update the project id, backend bucket name and, if necessary, the region, specified in the intra/main.tf and infra/terraform.tfvars 
to match your project and the bucket name and region specified in your bootstrap/ terraform.tfvars file. 
(FYI-Variables cant be used when specifying a remote backend)

run fmt against the infra files prior to uploading to the repo

	cd infra
	terraform fmt
	cd .. 

create a feature branch
	
	git checkout -b feat/first-plan

add infra 
	
	git add infra

commit

	git commit -m "Add infra (backend/providers/demo)"

push the branch
	
	git push -u origin feat/first-plan


Create a branch that changes something under infra/, open a PR ? terraform-plan runs and comments the plan.

Merge to main ? terraform-apply runs. Approve the prod environment ? resources are created.



